!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery"),require("underscore"),require("brix/loader"),require("components/base")):"function"==typeof define&&define.amd?define(["jquery","underscore","brix/loader","components/base"],t):"object"==typeof exports?exports["components/uploader"]=t(require("jquery"),require("underscore"),require("brix/loader"),require("components/base")):e["components/uploader"]=t(e.jquery,e.underscore,e["brix/loader"],e["components/base"])}(this,function(e,t,r,n){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){var n,o;n=[r(2),r(3),r(4),r(5)],o=function(e,t,r,n){function o(){return("token"+Math.random()).replace(/\D/g,"")}function i(){}var a='<input name="<%= name %>" type="file" class="uploader-ghost">',s="data-token",p="["+s+"]",c=".uploader";return i.burn=function(t){var r=e(t);r.replaceWith(r.clone(!0,!0).attr(s,o()).prop("clientId",r.prop("clientId")))},i.transports={iframe:function(r,n){var o=e.Deferred(),a="FILE_UPLOAD_IFRAME_",s='<iframe id="<%= id %>" name="<%= id %>" style="display: none;"></iframe>';n.target=a+t.uniqueId(),n.action=r.action,n.method="POST",n.enctype="multipart/form-data";var p=t.template(s)({id:n.target});return e(p).insertAfter(n).on("load",function(t){var r=t.target,n=e((r.contentWindow||r.contentDocument).document.body),a=n.find("#result"),s=e.trim(a.length?a.text():n.text());i.parseJSONResponse(s,function(e,t){e?o.reject(e,r):o.resolve(t,r)}),e(r).remove()}).on("error",function(e){var t=e.target;o.reject(e,t)}),n.submit(),o.promise()},xhr:function(r,n,o){var a=e.Deferred(),s=new FormData;t.each(o.files,function(e){s.append(r.name,e)});var p=new XMLHttpRequest;return p.overrideMimeType("application/json"),p.open("post",r.action,!0),p.upload.onprogress=function(e){e.percent=Math.round(e.loaded/e.total*100),a.notify(e,p)},p.onload=function(){var e=p.responseText;i.parseJSONResponse(e,function(e,t){e?a.reject(e,p):a.resolve(t,p)})},p.onerror=function(e){a.reject(e,p)},p.onabort=function(){a.reject("canceled",p)},p.ontimeout=function(){a.reject("timeout",p)},p.send(s),a.promise()}},i.parseJSONResponse=function(e,t){try{t(void 0,JSON.parse(e))}catch(r){try{t(void 0,new Function("return "+e)())}catch(n){t(n,e)}}finally{}},i.readFileAsDataURL=function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsDataURL(e)},t.extend(i.prototype,n.prototype,{options:{action:"",name:"file",transport:"iframe",multiple:!0,accept:""},render:function(){this.$element=e(this.element),this.$element.parent().css("position","relative");var n=e(t.template(a)(this.options)).attr(s,o()).prop("clientId",this.options.clientId).prop("disabled",this.$element.prop("disabled")).insertAfter(this.$element).width(this.$element.outerWidth()).height(this.$element.outerHeight()).offset(this.$element.offset());this.options.multiple&&n.attr("multiple","multiple"),this.options.accept&&n.prop("accept",this.options.accept);var u=n[0].form;u||(n.wrap('<form class="uploader-ghost-form">'),u=n[0].form),e(u).off("change"+c).on("change"+c,"input[type=file]"+p,function(t){var n=t.currentTarget,o=r.query(n)[0],a=e.Event("start"+c);return o.trigger(a,[n.files]),a.isDefaultPrevented()?void i.burn(n):void o.send(u,n).then(function(e,t){o.trigger("success"+c,[n.files,e,t])},function(e,t){o.trigger("error"+c,[n.files,e,t])},function(e,t){o.trigger("progress"+c,[n.files,e,t])}).always(function(){try{o.trigger("complete"+c,[n.files])}finally{i.burn(n)}})})},send:function(e,t){return i.transports[this.options.transport](this.options,e,t)}}),i}.apply(t,n),!(void 0!==o&&(e.exports=o))},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n}])});
//# sourceMappingURL=uploader.js.map
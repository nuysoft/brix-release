define(["jquery","underscore","brix/loader","components/base","brix/event","./state.js","./pagination.tpl.js"],function(t,e,i,s,n,o,a){function r(){}return e.extend(r.prototype,s.prototype,{options:{statistics:!0,simplify:!1,step:7,total:0,cursor:1,limit:10,limits:[10,20,30,40,50]},init:function(){this._state=new o(this.options.total,this.options.cursor,this.options.limit)},render:function(){var s=this,o=new n;this.$element=t(this.element),this.data=this.fixData();var r=e.template(a)(this.data);t(this.element).empty().append(r),o.delegate(this.element,this),i.boot(this.element,function(){s.dropdown=i.query("components/dropdown",s.element)[0],s.dropdown&&s.dropdown.on("change.dropdown",function(t,e){s._state.setLimit(e.value),s.trigger("change.pagination",s._state),s.render()})})},moveTo:function(t,e){1===arguments.length&&(e=t),this._state.moveTo(e),this.trigger("change.pagination",this._state),this.render()},total:function(t){return void 0===t||null===t?this._state.total:(this._state.total!==t&&(this._state.setTotal(t),this.render()),this)},cursor:function(t){return void 0===t||null===t?this._state.cursor:(this._state.cursor!==t&&(this._state.setCursor(t),this.render()),this)},fixData:function(){var t=Math.min(this._state.pages,Math.max(1,this._state.cursor-parseInt(this.options.step/2,10))),i=+this.options.limit,s=[].concat(this.options.limits).sort();if(!e.contains(s,i))switch(!0){case i<s[0]:s.unshift(i);break;case i>s[s.length-1]:s.push(i);break;default:for(var n=0;n<s.length;n++)if(i>s[n]){s.splice(n+1,0,i);break}}return e.extend({barStart:t,barEnd:Math.min(this._state.pages,t+this.options.step-1),limits:s,simplify:this.options.simplify},this._state)}}),r});